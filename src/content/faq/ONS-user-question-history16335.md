---
id: "question-history-16335"
title: "当消费失败的时候如何重新消费消息？"
date: "2024-09-26"
category: "expertConsultation"
description: "根据提供的我了解的信息，当RocketMQ中消费失败时，重新消费消息的处理方式取决于消费者所采用的模式：集群模式或广播模式。以下是详细的步骤和解释：### 1. 集群模式下的重试机制在集群模式下，如果一条消息消费失败，可以通过以下步骤来实现重新消费：1. **业务逻辑返回特定状态**：消费的业务逻辑"
tags: ["rocketmq","消费失败","重新消费","消息","处理策略"]
keywords: ["rocketmq","消费失败","重新消费","消息","处理策略"]
---

## 用户问题 ： 
 当消费失败的时候如何重新消费消息？  

---------------
## 专家官方解答 ：

根据提供的我了解的信息，当RocketMQ中消费失败时，重新消费消息的处理方式取决于消费者所采用的模式：集群模式或广播模式。以下是详细的步骤和解释：

### 1. 集群模式下的重试机制
在集群模式下，如果一条消息消费失败，可以通过以下步骤来实现重新消费：
1. **业务逻辑返回特定状态**：消费的业务逻辑代码需要返回`Action.ReconsumeLater`、`NULL`或者抛出异常。
2. **重试次数限制**：消息最多会被重试16次。如果在这之后仍然消费失败，该消息将被丢弃。

#### 解释
- 当消费者的业务逻辑检测到消息处理失败（例如数据库操作失败等），它应当通过返回上述状态之一告知RocketMQ服务端这条消息未能成功处理。
- RocketMQ会自动按照预设的时间间隔尝试再次发送这条消息给同一个消费者实例进行重试，直到达到最大重试次数为止。这种机制旨在为短暂性的错误提供恢复机会，比如网络波动导致的一时无法连接到外部系统等情况。
- 如果超过最大重试次数后消息仍未被成功消费，则会被视为无效并从队列中移除。此时可能需要人工介入检查具体原因，并考虑是否需要手动处理这些“死信”。

### 2. 广播模式下的重试机制
对于广播模式，RocketMQ保证每条消息至少被每个订阅者消费一次，但不支持自动重试功能。因此，在广播模式下遇到消费失败的情况，通常需要开发者自行设计解决方案，如记录失败消息ID然后单独处理。

### 注意事项
- 在使用消费重试机制时，应确保消费失败的原因不是持续存在的问题，否则可能导致大量不必要的重试消耗资源。
- 对于那些预期会发生且不可恢复的错误情况，建议不要依赖于重试机制，而是应该有更合适的错误处理策略，比如将此类消息直接送入特殊队列供后续分析处理。

综上所述，针对不同的消费模式，RocketMQ提供了相应的重试策略以帮助应对暂时性故障，但在设计应用程序时也需要注意合理利用这些特性避免潜在的问题。更多关于如何优化消费重试策略的信息可以参考[《RocketMQ 重试机制详解及最佳实践》](https://rocketmq-learning.com/learning/rocketmq-retry/)。


<font color="#949494">---------------</font> 


## 参考链接 ：

* 专家经验：rocketmq  经常被问到的问题 
 
 * 专家经验：消费重试 
 
 * 专家经验：当消费失败的时候如何重新消费消息？ 


 <font color="#949494">---------------</font> 
 


## <font color="#FF0000">答疑服务说明：</font> 

本内容经由技术专家审阅的用户问答的镜像生成，我们提供了<font color="#FF0000">专家智能答疑服务</font>,使用方法：
用法1： 在<font color="#FF0000">页面的右下的浮窗”专家答疑“</font>。
用法2： 点击[专家答疑页](https://answer.opensource.alibaba.com/docs/intro)（针对部分网站不支持插件嵌入的情况）
### 另：


有其他开源产品的使用问题？[点击访问阿里AI专家答疑服务](https://answer.opensource.alibaba.com/docs/intro)。
### 反馈
如问答有错漏，欢迎点：[差评](https://ai.nacos.io/user/feedbackByEnhancerGradePOJOID?enhancerGradePOJOId=17212)给我们反馈。
