---
id: "question-history-16333"
title: "消息只会被传递一次吗？"
date: "2024-09-26"
category: "expertConsultation"
description: "根据我了解的信息中的信息，RocketMQ 确保所有消息至少传递一次。在大多数情况下，消息不会重复，但不保证一定不重复。### 为什么会出现重复消息- **发送消息阶段**：在分布式环境下，可能会遇到典型的超时问题，这可能导致消息被多次发送。- **订阅消息阶段**：由于涉及集群订阅，多个订阅者需要"
tags: ["rocketmq","消息","传递","一次","判断","机制","可靠性"]
keywords: ["rocketmq","消息","传递","一次","判断","机制","可靠性"]
---

## 用户问题 ： 
 消息只会被传递一次吗？  

---------------
## 专家官方解答 ：

根据我了解的信息中的信息，RocketMQ 确保所有消息至少传递一次。在大多数情况下，消息不会重复，但不保证一定不重复。

### 为什么会出现重复消息

- **发送消息阶段**：在分布式环境下，可能会遇到典型的超时问题，这可能导致消息被多次发送。
- **订阅消息阶段**：由于涉及集群订阅，多个订阅者需要通过Rebalance方式订阅，在Rebalance的过程中（如客户端发布、扩缩容、网络抖动、集群队列数变更等），可能会产生消息重复；如果订阅者意外宕机，且消费进度未及时存储，也会导致消息重复。

### 如何处理重复消息（幂等）

为了确保业务逻辑的正确性，建议应用方实现幂等操作。可以通过以下方法来去重：

- **根据MsgId去重**：虽然可以接收端根据msgId去重以保证收到的消息不重复，但这无法避免发送端发重复消息的情况，因此这种方法并不推荐。
- **根据业务key去重**：更推荐的方法是根据业务的一个主键去重。主键可以作为消息的一个属性，例如使用`msg.setKeys()`设置。

### 建议的步骤

1. **理解负载均衡和重复产生的原因**：
   - 可以参考《RocketMQ 客户端负载均衡机制详解及最佳实践》了解更多细节：[https://rocketmq-learning.com/learning/rocketmq-client/](https://rocketmq-learning.com/learning/rocketmq-client/)
   
2. **实现幂等操作**：
   - 在应用层面，确保每个业务操作都是幂等的。即无论该操作执行多少次，结果都是一样的。例如，对于一个订单支付的操作，可以基于订单ID进行去重，确保同一个订单只支付一次。

3. **检查并优化系统配置**：
   - 如果发现有较多重复消息，请首先排查是否因为大量消费失败导致消息重投。如果不是这种情况，可能需要联系相关技术支持进一步排查问题所在。

### 解释

上述步骤旨在帮助你更好地理解和处理RocketMQ中可能出现的消息重复问题。通过实现幂等操作，可以有效避免因消息重复而导致的业务异常。同时，了解RocketMQ的内部机制有助于你更好地定位和解决潜在的问题。


<font color="#949494">---------------</font> 


## 参考链接 ：

* 专家经验：消息只会被传递一次吗？ 
 
 * 专家经验：rocketmq  经常被问到的问题 
 
 * 专家经验：rocketmq  Schedule example 


 <font color="#949494">---------------</font> 
 


## <font color="#FF0000">答疑服务说明：</font> 

本内容经由技术专家审阅的用户问答的镜像生成，我们提供了<font color="#FF0000">专家智能答疑服务</font>,使用方法：
用法1： 在<font color="#FF0000">页面的右下的浮窗”专家答疑“</font>。
用法2： 点击[专家答疑页](https://answer.opensource.alibaba.com/docs/intro)（针对部分网站不支持插件嵌入的情况）
### 另：


有其他开源产品的使用问题？[点击访问阿里AI专家答疑服务](https://answer.opensource.alibaba.com/docs/intro)。
### 反馈
如问答有错漏，欢迎点：[差评](https://ai.nacos.io/user/feedbackByEnhancerGradePOJOID?enhancerGradePOJOId=17210)给我们反馈。
